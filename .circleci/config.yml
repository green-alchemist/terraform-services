version: 2.1

# Orbs for setting up the dynamic configuration.
orbs:
  path-filtering: circleci/path-filtering@0.1.3
  continuation: circleci/continuation@0.3.1

# This setup workflow is the only thing that runs initially.
# Its job is to determine which pipeline to run next.
workflows:
  setup:
    jobs:
      - path-filtering/filter:
          base-revision: kyle
          config-path: .circleci/continuation-config.yml
          mapping: |
            services/.*\.tf .circleci/pipelines/infrastructure.yml
            ci/.*\.tf .circleci/pipelines/infrastructure.yml
            services/portfolio-gatsby/.* .circleci/pipelines/gatsby.yml


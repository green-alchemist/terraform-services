version: 2.1

# 1. You must enable "setup" to use in-repo orbs.
setup: true

orbs:
  path-filtering: circleci/path-filtering@2.0.4

workflows:
  setup:
    jobs:
      - path-filtering/filter:
          base-revision: kyle
          # 3. This config path now points to a much simpler helper file.
          config-path: .circleci/continuation-config.yml
          mapping: |
            services/.*\.tf .circleci/pipelines/infrastructure.yml
            environments/.*\.tf .circleci/pipelines/infrastructure.yml
            ci/.*\.tf .circleci/pipelines/infrastructure.yml
            ./ .circleci/pipelines/default.yml

